---
title: 表格树状结构加复选框
date: 2020-10-08 17:46:00
permalink: /pages/c7e146/
categories: 
  - 前端框架
  - vue文章
tags: 
  - 
---


没有比活着更美好，没有比活着更艰辛 -- 余华《活着》

<!-- more -->

由于elementui表格组件中，没有复选框加树状结构功能的表格组件，而做项目要用，所以今天在elementUI的树状结构表格组件基础上，将复选框功能实现上去。具体效果图如下：

![组件示意图](https://i.loli.net/2020/10/08/iZ5QzXx4y81dHnB.png)

实现功能：

(1) 任一节点，勾选父级会默认勾选其所有子集

(2) 任一节点，取消父级勾选状态会默认取消其所有子集勾选状态

实现方法：数组遍历、递归

源码如下：

``` vue
<template>
  <div class="editDialog" v-if="pageData">
    <el-dialog title="设置角色权限" :visible.sync="dialogFormVisible" width="60%" @close="close">
      <el-table
        ref="multipleTable"
        :data="pageData.category"
        style="width: 100%;margin-bottom: 20px;"
        row-key="id"
        border
        :tree-props="{children: 'children', hasChildren: 'hasChildren'}"
      >
        选择框
        <el-table-column type="select" width="55">
          <template slot-scope="scope">
            <el-checkbox v-model="scope.row.checked" @change="getRowAllMenuId([scope.row], scope.row.checked)"></el-checkbox>
          </template>
        </el-table-column>

        <el-table-column prop="name" label="菜单权限"></el-table-column>
      </el-table>

      <div slot="footer" class="dialog-footer">
        <el-button @click="close">取 消</el-button>
        <el-button type="primary" @click="confirm">保 存</el-button>
      </div>
    </el-dialog>
  </div>
</template>

<script>
export default {
  props: {
    id: [Number, String]
  },
  data() {
    return {
      dialogFormVisible: true,
      pageData: null,

      formData: {
        roleId: "",
        menuId: []
      },

      checked: true
    };
  },
  methods: {
    // 获取数据
    getPageData() {
      this.$api({
        url: `/admin/rbac/authorize/id/${this.id}.html`,
        method: "GET"
      }).then(res => {
        console.log(res);
        this.pageData = res.data.data;
        this.formData.roleId = this.pageData.roleId;

        this.getAllMenuId(this.pageData.category);
      });
    },

    // 初始化递归所有数据
    getAllMenuId(arr) {
      arr.forEach((item, index) => {
        // 对于选中的目录，将其id添加到数组中
        if (item.checked) {
          this.formData.menuId.push(item.id);
        }

        if (item.children && item.children.length) {
          this.getAllMenuId(item.children);
        }
      });
    },

    // 选中或取消时递归当前行及其所有子行的数据
    getRowAllMenuId(array, isChecked) {
      array.forEach((item, index, arr) => {
        item.checked = isChecked;
        // 如果是选中选择框，并且数组中没有记录，并且其children不为0        则让其进入数组记录，并递归其子集
        if (
          isChecked &&
          this.formData.menuId.indexOf(item.id) == -1 &&
          item.children.length
        ) {
          this.formData.menuId.push(item.id);
          this.getRowAllMenuId(item.children, true);
        }
        // 如果是选中选择框，并且数组中没有记录，并且其children为0          则让其直接进入数组记录即可
        else if (
          isChecked &&
          this.formData.menuId.indexOf(item.id) == -1 &&
          !item.children.length
        ) {
          this.formData.menuId.push(item.id);
        }

        // 如果取消选中，数组中有记录，并且其children不为0         则从数组中将其删除，并且递归其子集
        else if (
          !isChecked &&
          this.formData.menuId.indexOf(item.id) != -1 &&
          item.children.length
        ) {
          this.formData.menuId.splice(this.formData.menuId.indexOf(item.id), 1);
          this.getRowAllMenuId(item.children, false);
        }
        // 如果取消选中，数组中有记录，并且其children为0          则从数组中删除即可
        else if (
          !isChecked &&
          this.formData.menuId.indexOf(item.id) != -1 &&
          !item.children.length
        ) {
          this.formData.menuId.splice(this.formData.menuId.indexOf(item.id), 1);
        }
      });
    },

    // 确定按钮
    confirm() {
      this.$api({
        url: "/admin/rbac/authorizepost.html",
        method: "POST",
        data: this.formData
      }).then(res => {
        console.log(res);
        if (res.data.code == 1) {
          this.$message({
            type: "success",
            message: res.data.msg
          });

          this.close();
        } else {
          this.$message.error(res.data.msg);
        }
      });
    },
    // 关闭按钮
    close() {
      this.$emit("close");
    }
  },
  created() {
    this.getPageData();
  }
};
</script>
```

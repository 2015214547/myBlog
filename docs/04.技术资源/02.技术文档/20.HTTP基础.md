---
title: 前端http基础
date: 2020-07-08 17:04:54
permalink: /pages/da4eb0/
tags: 
  - HTTP
categories: 
  - 技术资源
  - 技术文档
---
# 前端http基础

&emsp;&emsp;HTTP建立之初主要是为了传输超文本标记语言文档（HTML），随时代发展进行了若干次演进。

## 关于TCP

&emsp;&emsp;客户端和服务器端三次握手只为建立TCP连接，TCP连接是为后续的数据传输做准备

> TCP：传输控制协议

## http/1.0

&emsp;&emsp;http1.0不会复用tcp链接，每次请求都会打开、断开一条链接。由于TCP是有延迟响应机制的，每次请求并不会马上返回，所以http1.0性能不好。

## http/1.1

&emsp;&emsp;http1.1是当前最普及的版本，http1.1中TCP链接可以持久保持（即一段时间内，一个tcp链接会等到同一域名下的所有资源加载完之后再断开）

&emsp;&emsp;通过一条TCP链接请求资源时，只有上一个请求完成后，才能发出下一个请求。当使用**http管道**时，则可以并发发送多个请求。但是http1.1有严格的**串行返回响应机制**，即：请求时不用等上一个完成，但响应时必须严格按照顺序返回。

&emsp;&emsp;所以基于“HTTP管道”的特性，万一第一个响应时间很长，那么后面的响应处理完了也无法发送，只能被缓存起来，占用服务器内存，即：**队首阻塞**

::: tip http1.1下优化方案

- **合并css、js**：
  - 优点：减少http请求
  - 缺点：所有文件合并成大文件，无论哪个模块发生变化，用户都要整体重新更新，无法继续使用缓存；

- **分域名**：
  - 优点：可以绕过浏览器对同一域名的最大管道限制，可以同时请求到更多内容。

- **接口合并**：
  - 优点：将数据汇总到一个接口，可以减少http请求数量。
  - 缺点：违背了程序设计规范，会导致接口很难复用，维护成本很高。

:::

## http/2.0

对前端的性能优化主要应该从两个方面：加载速度、流畅运行

::: tip http2.0引入以下机制、特性，进而达到加速效果：

- 二进制分帧层

- 多路复用

- 首部压缩

- 服务器推进

:::

### 二进制分帧层与多路复用

> 引入二进制分帧层，就不再是文本传输，而是数据帧传输（二进制）
> 
> <font color="red">注意：HTTP原本的语义、方法、动词、首部都不受影响，仅仅是传输期间的数据格式发生了变化</font>

> http2.0规定了10种不同的帧，TCP 连接在客户端和服务器间建立了一条运输的通道，可以双向通行，当一端要向另一端发送消息时，会先把这个消息拆分成几部分（帧），然后通过发起一个流对这些帧进行发送，最后在另一端将同一个流的帧重新组合。

> 帧会对数据进行顺序标识，这样浏览器收到数据之后，就可以按照序列对数据进行合并，而不会出现合并后数据错乱的情况。同样是因为有了序列，服务器就可以并行的传输数据，这就是流所做的事情。

> HTTP/2对同一域名下所有请求都是基于流，也就是说同一域名不管访问多少文件，也只建立一路连接。同样Apache的最大连接数为300，因为有了这个新特性，最大的并发就可以提升到300，比原来提升了6倍！

### 首部压缩

> 在服务器和客户端各维护一个“首部表”，表中用索引代表首部名，或者首部键 - 值对，上一次发送两端都会记住已发送过哪些首部，下一次发送只需要传输差异的数据，相同的数据直接用索引表示即可。首部压缩，可以解决http头臃肿的问题。

### 服务器推送

> 服务器可以对一个客户端请求发送多个响应。也就是说，除了对最初请求的响应外，服务器还可以额外向客户端推送资源。